<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Steven Bedrick" />


<title>Lab 07: Interactive Vis With Shiny</title>

<script src="site_libs/header-attrs-2.8/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">BMI 5/625 Labs, Spring 2021</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="slides.html">Slides &amp; Reading</a>
</li>
<li>
  <a href="data-vis-resources.html">Resources</a>
</li>
<li>
  <a href="https://sakai.ohsu.edu/portal/site/CS-631-1-31934-Sp20">Sakai</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">About</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Lab 07: Interactive Vis With Shiny</h1>
<h3 class="subtitle">BMI 5/625</h3>
<h4 class="author">Steven Bedrick</h4>

</div>


<div id="introduction" class="section level1" number="1">
<h1 number="1"><span class="header-section-number">1</span> Introduction</h1>
<p><code>Shiny</code> is a powerful R library for making interactive web sites containing visualizations and tables. In this lab, you will learn the basics of designing and building a simple interactive dashboard for exploring a data set. Since the final product of a Shiny application is a web site, much of what you learned in the last lab will be useful this week!</p>
<div id="getting-started" class="section level2" number="1.1">
<h2 number="1.1"><span class="header-section-number">1.1</span> Getting Started</h2>
<p>To begin, install and load the <code>shiny</code> library. We’ll also load the <code>tidyverse</code>:</p>
<pre class="r"><code>library(shiny)
library(tidyverse)</code></pre>
<p>In the last lab, we learned about <em>static</em> web site. Under this model, the web site consists of a collection of HTML files (along with images, etc.); the user, via their web browser, <em>requests</em> those files from a <em>server</em>. The server’s role is to find the requested file, and then send it back to the browser (the <em>response</em>).</p>
<p>A Shiny application is an example of a <em>dynamic</em> website. The first part of the process is the same: the user interacts with the web site via their browser, and the results of their interactions (links or buttons clicked, form fields filled out, etc.) are sent to the server in the form of a request. The server’s role is quite different under a dynamic scenario. Instead of simply finding a static page and returning it, the server instead executes a program (specified in the request), and sends the results of that program back to the browser as the response.</p>
<p>The results often take the form of <em>rendered</em> HTML. That is to say, HTML that is dynamically generated in response to the user’s actions and input, rather than loaded directly from a file on disk. In a Shiny application, this takes the form of an R program.</p>
<p>Shiny applications divide their world between a <em>front end</em>, the user interface that the browser displays, and the <em>back end</em>, the chunks of R code that are run in response to user actions.</p>
</div>
<div id="first-step-with-shiny" class="section level2" number="1.2">
<h2 number="1.2"><span class="header-section-number">1.2</span> First step with <code>shiny</code>:</h2>
<p>The structure of a <code>shiny</code> application is simple. You’ll need a file called <code>app.R</code>, with three main pieces.</p>
<ol style="list-style-type: decimal">
<li>Code describing the <em>front end</em>: what text goes where, what buttons are present, etc.</li>
<li>Code describing the <em>back end</em>: what should happen in response to user activities, and how to compute figures, tables, etc.</li>
<li>A call to the <code>shinyApp()</code> function, to actually run your application</li>
</ol>
<p>Here is a simple <code>app.R</code>:</p>
<pre class="r"><code>library(shiny)

ui &lt;- fluidPage(
  titlePanel(&quot;Hello, world!&quot;),
  &quot;This is some text!&quot;
)

server &lt;- function(input, output, session) {
  # nothing to do here, for now
}

shinyApp(ui = ui, server = server)</code></pre>
<p>Try putting this in your <code>app.R</code> and run it. You should see something like this:</p>
<p><img src="07-shiny_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Note above the <code>titlePanel()</code> function. This is a function whose output is HTML:</p>
<pre class="r"><code>titlePanel(&quot;Hello, world!&quot;)</code></pre>
<pre><code>[1] &quot;&lt;h2&gt;Hello, world!&lt;/h2&gt;&quot;</code></pre>
<p>We’ll see that Shiny includes a variety of other functions for controlling the HTML that goes in to our UI.</p>
</div>
</div>
<div id="make-it-dynamic" class="section level1" number="2">
<h1 number="2"><span class="header-section-number">2</span> Make it dynamic</h1>
<p>This is a complete application, but it doesn’t do anything interesting. Let’s make it a bit more interesting, and have it print the date and time that the page was loaded.</p>
<p>There are a few new pieces here:</p>
<ol style="list-style-type: decimal">
<li>We have added a <code>textOutput</code> element to our UI;</li>
<li>Assigned it the name <code>timestamp</code>, and</li>
<li>In the <code>server</code> function, we are calling <code>renderText()</code> to populate it:</li>
</ol>
<pre class='prettyprint'><code>library(shiny)<br><br>ui <- fluidPage(<br>&nbsp;&nbsp;titlePanel("Hello, world!"),<br>&nbsp;&nbsp;"This is some text!",<br>&nbsp;&nbsp;<span style="background-color:#ffff7f">textOutput</span>("timestamp"),<br>)<br><br>server <- function(input, output, session) {<br><br>&nbsp;&nbsp;output$timestamp <- <span style="background-color:#ffff7f">renderText</span>({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;paste0("The current time is: ", Sys.time())<br>&nbsp;&nbsp;&nbsp;&nbsp;})<br>}<br><br>shinyApp(ui = ui, server = server)</code></pre>
<p>There are corresponding <code>*Output</code> elements (and <code>render*()</code> functions) for images, plots, tables, etc. We’ll see examples of that as we move forward.</p>
<p>The other important thing to notice in this example is that we are giving our UI element an identifier, “<code>timestamp</code>”, which we use later in the server function:</p>
<pre class='prettyprint'><code>library(shiny)<br><br>ui <- fluidPage(<br>&nbsp;&nbsp;titlePanel("Hello, world!"),<br>&nbsp;&nbsp;"This is some text!",<br>&nbsp;&nbsp;textOutput("<span style="background-color:#ffff7f">timestamp</span>"),<br>)<br><br>server <- function(input, output, session) {<br><br>&nbsp;&nbsp;output$<span style="background-color:#ffff7f">timestamp</span> <- renderText({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;paste0("The current time is: ", Sys.time())<br>&nbsp;&nbsp;&nbsp;&nbsp;})<br>}<br><br>shinyApp(ui = ui, server = server)</code></pre>
<p>This is a key pattern in Shiny. A way to think about it is that the element IDs are links that let the front-end and back-end communicate with one another. When you run this application, you should see something like this:</p>
<p><img src="07-shiny_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<div id="collecting-user-input" class="section level2" number="2.1">
<h2 number="2.1"><span class="header-section-number">2.1</span> Collecting User Input</h2>
<p>We frequently want to collect input from our user (for example, to specify which data set to visualize, set the title of a plot, a value to filter by, etc.). Shiny makes this easy. Our next application will ask the user for their name, and then tell us how long their name is. (This is kind of a silly example, but will illustrate how to capture user-entered info). Let us begin with the UI:</p>
<pre class="r"><code>library(shiny)

ui &lt;- fluidPage(
  titlePanel(&quot;Name Measurement&quot;),
  textInput(&quot;name&quot;, label=&quot;What is your name?&quot;),
  textOutput(&quot;nameLength&quot;)
)

server &lt;- function(input, output, session) {
}

shinyApp(ui = ui, server = server)</code></pre>
<p>We have added a new element: <code>textInput</code>. This is one of the many <code>*input()</code> elements, corresponding to things like text boxes, drop-down menus, date pickers, sliders (for entering numeric values), etc. (See the <a href="https://shiny.rstudio.com/gallery/widget-gallery.html">Shiny Widgets Gallery</a> for examples of each of the available controls).</p>
<p>When we run this application, we should see something like this:</p>
<p><img src="07-shiny_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>How might we <em>access</em> the value of our <code>name</code> field from the back-end? To <em>set</em> a value in the UI, we used the <code>output</code> variable; to <em>get</em> a value <em>from</em> the UI, we use the <code>input</code> variable. We will use <code>stringr</code>’s <code>str_length()</code> function, and send its output back via <code>renderText()</code>:</p>
<pre class='prettyprint'><code>server <- function(<span style="background-color:#ffff7f">input</span>, output, session) {<br>&nbsp;&nbsp;output$nameLength <- renderText(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;paste0("Your name is ", str_length(<span style="background-color:#ffff7f">input</span>$name), " letters long.")<br>&nbsp;&nbsp;&nbsp;&nbsp;)<br>}</code></pre>
<p>Try adding this line to your server function, and run the application. You should see something like this:</p>
<p><img src="07-shiny_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>What happens if you type your name in the text box?</p>
<p><img src="07-shiny_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>Note that the contents of the UI automatically updates when fields change. Shiny uses a <em>reactive</em> programming model, in which elements on the page automatically react to one another.</p>
<p>Another thing to note here is that we are providing <code>textInput</code> with a default value (“Steven”, in this case). What happens if we <em>don’t</em> do this?</p>
</div>
<div id="including-a-plot" class="section level2" number="2.2">
<h2 number="2.2"><span class="header-section-number">2.2</span> Including a plot</h2>
<p>Let’s do something more interesting than just showing the length of a name; let’s instead show a plot, using data from the <code>babynames</code> package. The plot will be a simple line plot for a particular name, split by sex:</p>
<pre class="r"><code>babynames %&gt;% 
            filter(name==&quot;Steven&quot;) %&gt;% 
            ggplot(mapping=aes(x=year, y=prop, color=sex)) + 
            geom_line() + 
            ggtitle(&quot;Name Frequency: Steven&quot;)</code></pre>
<p><img src="07-shiny_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>Nothing fancy, but that’s fine- let’s get it into our Shiny application. We will use the <code>plotOutput</code>/<code>renderPlot</code> functions:</p>
<pre class='prettyprint'><code>library(shiny)<br>library(babynames)<br><br>ui <- fluidPage(<br>&nbsp;&nbsp;titlePanel("Name Measurement"),<br>&nbsp;&nbsp;textInput("name", label="What is your name?", value="Steven"),<br>&nbsp;&nbsp;<span style="background-color:#ffff7f">plotOutput</span>("namePlot")<br>)<br><br>server <- function(input, output, session) {<br>&nbsp;&nbsp;&nbsp;&nbsp;output$namePlot <- <span style="background-color:#ffff7f">renderPlot</span>({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;babynames %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filter(name==input$name) %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ggplot(mapping=aes(x=year, y=prop, color=sex)) + <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;geom_line() + <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ggtitle(paste0("Name Frequency: ", input$name))<br>&nbsp;&nbsp;&nbsp;&nbsp;})<br>}<br><br>shinyApp(ui = ui, server = server)</code></pre>
<p><code>plotOutput</code> can take display figures made with either <code>plot()</code> or <code>ggplot()</code>.</p>
<p>Note that we are now providing the <code>name</code> text box a default value, so that the page has something to show when it first loads. What happens if you take that out?</p>
<p>Also note that our <code>renderPlot()</code> call is using curly-braces, so that we can give it multiple lines of input.</p>
</div>
<div id="including-a-table" class="section level2" number="2.3">
<h2 number="2.3"><span class="header-section-number">2.3</span> Including a table</h2>
<p>In addition to a plot, let’s also include a little data table showing the year in which the name in question was most popular. Our code to generate the table will look like this:</p>
<pre class="r"><code>babynames %&gt;% 
  filter(name==&quot;Steven&quot;) %&gt;% 
  group_by(sex) %&gt;% 
  arrange(year) %&gt;% 
  top_n(1, prop) %&gt;% 
  select(-name) </code></pre>
<pre><code># A tibble: 2 x 4
# Groups:   sex [2]
   year sex       n      prop
  &lt;dbl&gt; &lt;chr&gt; &lt;int&gt;     &lt;dbl&gt;
1  1955 M     37816 0.0181   
2  1979 F       137 0.0000795</code></pre>
<p>As you might imagine, Shiny has an <code>tableOutput()</code>/<code>renderTable()</code> pair:</p>
<pre class='prettyprint'><code>library(shiny)<br>library(babynames)<br><br>ui <- fluidPage(<br>&nbsp;&nbsp;titlePanel("Name Measurement"),<br>&nbsp;&nbsp;textInput("name", label="What is your name?", value="Steven"),<br>&nbsp;&nbsp;plotOutput("namePlot"),<br>&nbsp;&nbsp;<span style="background-color:#ffff7f">tableOutput</span>("<span style="background-color:#ffff7f">nameTable</span>")<br>)<br><br>server <- function(input, output, session) {<br>&nbsp;&nbsp;&nbsp;&nbsp;output$namePlot <- renderPlot({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;babynames %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filter(name==input$name) %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ggplot(mapping=aes(x=year, y=prop, color=sex)) + <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;geom_line() + <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ggtitle(paste0("Name Frequency: ", input$name)) <br>&nbsp;&nbsp;&nbsp;&nbsp;})<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;output$<span style="background-color:#ffff7f">nameTable</span> <- <span style="background-color:#ffff7f">renderTable</span>({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;babynames %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filter(name==input$name) %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;group_by(sex) %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arrange(year) %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;top_n(1, prop) %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select(-name) <br><br>&nbsp;&nbsp;&nbsp;&nbsp;})<br>}<br><br>shinyApp(ui = ui, server = server)</code></pre>
<p><img src="07-shiny_files/figure-html/withTableToDisplay-1.png" width="672" /></p>
<p>This is kind of basic-looking, but can be customized as much as one might wish, using any of the table formatting techniques we discussed earlier in the term. Notably, the <code>gt</code> package includes some special Shiny-related functions. Here’s a fancier version of the table from above:</p>
<pre class="r"><code>babynames %&gt;% 
        filter(name==&quot;Steven&quot;) %&gt;% 
        group_by(sex) %&gt;% 
        arrange(year) %&gt;% 
        top_n(1, prop) %&gt;% 
        select(-name) %&gt;% ungroup() %&gt;% select(sex, year, prop) %&gt;% 
        arrange(sex) %&gt;% 
  gt() %&gt;% 
    cols_label(sex=&quot;Sex&quot;, year=&quot;Year&quot;, prop=&quot;Proportion&quot;) %&gt;% 
    fmt_number(columns=c(prop), decimals=5) %&gt;% 
    tab_header(title=&quot;Year of Maximum Steven, by sex&quot;)  %&gt;% 
    tab_source_note(md(&quot;From `babynames` package&quot;))</code></pre>
<div id="lldtcshiza" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#lldtcshiza .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#lldtcshiza .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lldtcshiza .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#lldtcshiza .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#lldtcshiza .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lldtcshiza .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lldtcshiza .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#lldtcshiza .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#lldtcshiza .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#lldtcshiza .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#lldtcshiza .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#lldtcshiza .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#lldtcshiza .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#lldtcshiza .gt_from_md > :first-child {
  margin-top: 0;
}

#lldtcshiza .gt_from_md > :last-child {
  margin-bottom: 0;
}

#lldtcshiza .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#lldtcshiza .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#lldtcshiza .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lldtcshiza .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#lldtcshiza .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lldtcshiza .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#lldtcshiza .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#lldtcshiza .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lldtcshiza .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lldtcshiza .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#lldtcshiza .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lldtcshiza .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#lldtcshiza .gt_left {
  text-align: left;
}

#lldtcshiza .gt_center {
  text-align: center;
}

#lldtcshiza .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#lldtcshiza .gt_font_normal {
  font-weight: normal;
}

#lldtcshiza .gt_font_bold {
  font-weight: bold;
}

#lldtcshiza .gt_font_italic {
  font-style: italic;
}

#lldtcshiza .gt_super {
  font-size: 65%;
}

#lldtcshiza .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  <thead class="gt_header">
    <tr>
      <th colspan="3" class="gt_heading gt_title gt_font_normal gt_bottom_border" style>Year of Maximum Steven, by sex</th>
    </tr>
    
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Sex</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Year</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Proportion</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">F</td>
<td class="gt_row gt_right">1979</td>
<td class="gt_row gt_right">0.00008</td></tr>
    <tr><td class="gt_row gt_left">M</td>
<td class="gt_row gt_right">1955</td>
<td class="gt_row gt_right">0.01810</td></tr>
  </tbody>
  <tfoot class="gt_sourcenotes">
    <tr>
      <td class="gt_sourcenote" colspan="3">From <code>babynames</code> package</td>
    </tr>
  </tfoot>
  
</table>
</div>
<p>We can integrate that into our Shiny display using <code>gt</code>’s <code>render_gt()</code> and <code>gt_output()</code> functions:</p>
<pre class='prettyprint'><code>library(shiny)<br>library(babynames)<br>library(gt)<br><br>ui <- fluidPage(<br>&nbsp;&nbsp;titlePanel("Name Measurement"),<br>&nbsp;&nbsp;textInput("name", label="What is your name?", value="Steven"),<br>&nbsp;&nbsp;plotOutput("namePlot"),<br>&nbsp;&nbsp;<span style="background-color:#ffff7f">gt_output</span>("<span style="background-color:#ffff7f">nameTable</span>")<br>)<br><br>server <- function(input, output, session) {<br>&nbsp;&nbsp;&nbsp;&nbsp;output$namePlot <- renderPlot({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;babynames %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filter(name==input$name) %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ggplot(mapping=aes(x=year, y=prop, color=sex)) + <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;geom_line() + <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ggtitle(paste0("Name Frequency: ", input$name)) <br>&nbsp;&nbsp;&nbsp;&nbsp;})<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;output$<span style="background-color:#ffff7f">nameTable</span> <- <span style="background-color:#ffff7f">render_gt</span>({<br>&nbsp;&nbsp;&nbsp;&nbsp;babynames %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filter(name==input$name) %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;group_by(sex) %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arrange(year) %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;top_n(1, prop) %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select(-name) %>% ungroup() %>% select(sex, year, prop) %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arrange(sex) %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;gt() %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cols_label(sex="Sex", year="Year", prop="Proportion") %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt_number(columns=c(prop), decimals=5) %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tab_header(title=paste0("Year of Maximum ", input$name, ", by sex")) &nbsp;%>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tab_source_note(md("From `babynames` package"))<br><br>&nbsp;&nbsp;&nbsp;&nbsp;})<br>}<br><br>shinyApp(ui = ui, server = server)</code></pre>
</div>
</div>
<div id="organizing-our-app" class="section level1" number="3">
<h1 number="3"><span class="header-section-number">3</span> Organizing our app</h1>
<p>At this point, our <code>server</code> function is getting a bit unruly. A good practice is to <em>encapsulate</em> various parts of the display into separate functions, like so:</p>
<pre class='prettyprint'><code>library(shiny)<br>library(babynames)<br>library(gt)<br><br><span style="background-color:#ffff7f">makePlot</span> <- function(nameToUse) {<br>&nbsp;&nbsp;babynames %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filter(name==nameToUse) %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ggplot(mapping=aes(x=year, y=prop, color=sex)) + <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;geom_line() + <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ggtitle(paste0("Name Frequency: ", nameToUse))<br>}<br><br><span style="background-color:#ffff7f">makeTable</span> <- function(nameToUse) {<br>&nbsp;&nbsp;babynames %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filter(name==nameToUse) %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;group_by(sex) %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arrange(year) %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;top_n(1, prop) %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select(-name) %>% ungroup() %>% select(sex, year, prop) %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arrange(sex) %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;gt() %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cols_label(sex="Sex", year="Year", prop="Proportion") %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt_number(columns=c(prop), decimals=5) %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tab_header(title=paste0("Year of Maximum ", nameToUse, ", by sex")) &nbsp;%>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tab_source_note(md("From `babynames` package"))<br>}<br><br>ui <- fluidPage(<br>&nbsp;&nbsp;titlePanel("Name Measurement"),<br>&nbsp;&nbsp;textInput("name", label="What is your name?", value="Steven"),<br>&nbsp;&nbsp;plotOutput("namePlot"),<br>&nbsp;&nbsp;gt_output("nameTable")<br>)<br><br>server <- function(input, output, session) {<br>&nbsp;&nbsp;&nbsp;&nbsp;output$namePlot <- renderPlot(<span style="background-color:#ffff7f">makePlot</span>(input$name))<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;output$nameTable <- render_gt(<span style="background-color:#ffff7f">makeTable</span>(input$name))<br>}<br><br>shinyApp(ui = ui, server = server)</code></pre>
<p>Note that the functions that make the plot and the table do not directly reference the <code>input</code> variable provided by Shiny- they would work just fine “one their own”, independent of whether we were using Shiny or not. Similarly, the parts of the application responsible for handling input and output via Shiny (i.e., <code>textInput</code>, <code>renderPlot</code>) do not need to concern themselves with the details of what might be involved in generating the plots, etc.</p>
<p>This is an example of <em>decoupling</em> the different parts of our application from one another: the code to generate the tables and plots can be written and tested independently of the parts of the program that are , and as a result changes that we make to one part will (hopefully) not have any impact on the other parts.</p>
</div>
<div id="customizing-the-layout" class="section level1" number="4">
<h1 number="4"><span class="header-section-number">4</span> Customizing the layout</h1>
<p>Visually, the layout of our page is starting to get a bit long; what if we wanted to arrange it so that the plot and the table were side-by-side? Shiny gives us many options for controlling the layout; the simplest is to arrange things in <em>rows</em> and <em>columns</em>. Shiny uses the “Bootstrap” CSS library, which is built around a 12-column layout. We can use the <code>fluidRow()</code> and <code>column()</code> functions to set things up a bit differently:</p>
<pre class='prettyprint'><code>ui <- fluidPage(<br>&nbsp;&nbsp;titlePanel("Name Measurement"),<br>&nbsp;&nbsp;textInput("name", label="What is your name?", value="Steven"),<br>&nbsp;&nbsp;<span style="background-color:#ffff7f">fluidRow</span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color:#ffff7f">column</span>(6, plotOutput("namePlot")),<br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color:#ffff7f">column</span>(6, gt_output("nameTable"))<br>&nbsp;&nbsp;)<br>)</code></pre>
<p>Between <code>fluidRow()</code> and <code>column()</code>, you can put together pretty much any layout you might want, but a useful shortcut may be to use the <code>sidebarLayout()</code> function:</p>
<pre class='prettyprint'><code>ui <- fluidPage(<br>&nbsp;&nbsp;titlePanel("Name Plot"),<br>&nbsp;&nbsp;<span style="background-color:#ffff7f">sidebarLayout</span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color:#ffff7f">sidebarPanel</span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;textInput("name", label="What is your name?", value="Steven")<br>&nbsp;&nbsp;&nbsp;&nbsp;),<br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color:#ffff7f">mainPanel</span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;plotOutput("namePlot"),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;gt_output("nameTable")<br>&nbsp;&nbsp;&nbsp;&nbsp;)<br>&nbsp;&nbsp;)<br>)</code></pre>
<p><code>sidebarLayout()</code> is one of several built-in layout helper functions in Shiny, and can be used to quickly build a more complex interface. Note that in the screenshot below, our “sidebar” is actually being placed <em>above</em> the plot; in reality, pages using <code>sidebarLayout</code> will be <em>responsive</em> to the window size in which they are viewed. In a narrower window (or on a phone) it will automatically reflow to a vertical layout.</p>
<p><img src="07-shiny_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
</div>
<div id="other-controls" class="section level1" number="5">
<h1 number="5"><span class="header-section-number">5</span> Other controls</h1>
<div id="drop-down-menus" class="section level2" number="5.1">
<h2 number="5.1"><span class="header-section-number">5.1</span> Drop-down menus</h2>
<p>What if, instead of letting the user type any name in, we wanted to restrict them to a pre-set list of names?</p>
<pre class='prettyprint'><code>ui <- fluidPage(<br>&nbsp;&nbsp;&nbsp;&nbsp;titlePanel("Name Measurement"),<br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color:#ffff7f">selectInput</span>("name", label="What is your name?", c("Steven", "Alison", "Jackie")),<br>&nbsp;&nbsp;&nbsp;&nbsp;fluidRow(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;column(6, plotOutput("namePlot")),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;column(6, gt_output("nameTable"))<br>&nbsp;&nbsp;&nbsp;&nbsp;)<br>)</code></pre>
<p>Of course, there’s nothing saying that this list has to be manually-entered! Imagine if we wanted it to be set to the top ten names in 2017:</p>
<pre class="r"><code>topNames &lt;- babynames %&gt;% 
  filter(year==2017) %&gt;% 
  group_by(sex) %&gt;% 
  arrange(prop) %&gt;% top_n(5) %&gt;% # top 5 names from m/f, so 10 in total
  ungroup() %&gt;% select(name)

ui &lt;- fluidPage(
    titlePanel(&quot;Name Measurement&quot;),
    selectInput(&quot;name&quot;, label=&quot;What is your name?&quot;, topNames),
    fluidRow(
        column(6, plotOutput(&quot;namePlot&quot;)),
        column(6, gt_output(&quot;nameTable&quot;))
    )
)</code></pre>
<p>This is a very powerful pattern for creating dynamic tables and plots!</p>
</div>
<div id="getting-fancy-observeevent" class="section level2" number="5.2">
<h2 number="5.2"><span class="header-section-number">5.2</span> Getting Fancy: <code>observeEvent</code></h2>
<p>Now let’s make the system more powerful. In the above example, I have set the list of names to be the top 10 names from 2017. Let’s allow the user to specify a year, using <code>numericInput</code>. This will involve a few new concepts, specifically around linking the value of one field to the value of another. First, let’s look at the UI:</p>
<pre class='prettyprint'><code>ui <- fluidPage(<br>&nbsp;&nbsp;&nbsp;&nbsp;titlePanel("Name Measurement"),<br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color:#ffff7f">numericInput</span>("year", label="Year", min=1880, max=2017, value=2017),<br>&nbsp;&nbsp;&nbsp;&nbsp;selectInput("name", label="Which Name?", <span style="background-color:#ffff7f">c()</span>),<br>&nbsp;&nbsp;&nbsp;&nbsp;fluidRow(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;column(6, plotOutput("namePlot")),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;column(6, gt_output("nameTable"))<br>&nbsp;&nbsp;&nbsp;&nbsp;)<br>)</code></pre>
<p>We’ve added a new input control, which will only allow numeric input that is within a certain range. We’ve also stopped manually specifying our select box options, since we want the list to be dynamic: it should contain the top ten names <em>for the selected year</em>. We need to somehow connect the <code>numericInput</code> box that we have created to the <code>selectInput</code>. We’ll do this in the server function:</p>
<pre class='prettyprint'><code>server <- function(input, output, session) {<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;namesToUse <- <span style="background-color:#ffff7f">reactive</span>({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;babynames %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filter(year==input$year) %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;group_by(sex) %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arrange(prop) %>% top_n(5) %>% <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ungroup() %>% select(name)<br>&nbsp;&nbsp;&nbsp;&nbsp;})<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color:#ffff7f">observeEvent</span>(namesToUse(), {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;updateSelectInput(session, "name", <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;choices=namesToUse(),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;label=paste0("Popular names in ", input$year)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>&nbsp;&nbsp;&nbsp;&nbsp;})<br>&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;# note: don't forget the code to actually make the plot and table!<br>&nbsp;&nbsp;<br>}</code></pre>
<p>There are two new things here. First is the use of the <code>reactive()</code> function, which sets up a new variable that Shiny will be in charge of. Any R variable that we want to either <em>use</em> or <em>be used by</em> a Shiny component must be wrapped in a <code>reactive()</code> call. In this case, our list of names depends on (i.e., is using) <code>input$year</code>, so we have to make it reactive.</p>
<p><strong>Try it out</strong>: What happens if we <em>don’t</em> wrap our code here in <code>reactive()</code>?</p>
<p>Once our list of common names has been made reactive, we can wire it up to other parts of the UI via <code>observeEvent()</code>. Code inside <code>observeEvent()</code> is run whenever the variable that it is connected to changes; in this case, <code>upateSelectInput()</code> will be run when a new year is entered. Pretty neat!</p>
</div>
</div>
<div id="deployment" class="section level1" number="6">
<h1 number="6"><span class="header-section-number">6</span> Deployment</h1>
<p>See the <a href="https://docs.rstudio.com/shinyapps.io/">shinyapps.io user guide</a> for information about deploying a simple Shiny app.</p>
</div>
<div id="deliverable" class="section level1" number="7">
<h1 number="7"><span class="header-section-number">7</span> Deliverable</h1>
<p>For this week, you will construct and deploy a Shiny app that will let the user explore Kieran Healy’s <a href="https://kjhealy.github.io/covdata/"><code>covdata</code> package</a> containing up-to-date COVID-19 data. There are a variety of interesting data sets in this package, including ; feel free to draw inspiration from some of his blog posts (under “Articles” on the <code>covdata</code> home page). Think about the kinds of visualization and analysis tasks that are well-supported by interactivity, and recall Shneiderman’s mantra (“Overview first, zoom and filter, then details on demand”) as you work.</p>
<p>I strongly recommend referring to the <a href="https://cslu.ohsu.edu/~bedricks/courses/bmi525/syllabus/7-seventh.html">Shiny links on the syllabus</a> for additional information and ideas!</p>
</div>

<p>
<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">
<img alt="Creative Commons License" style="border-width:0" src="by-nc.png" width="133" height="25"/></a>
</p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
